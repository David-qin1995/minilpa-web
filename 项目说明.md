# MiniLPA Web 项目说明

## 项目概述

MiniLPA Web 是一个基于 Web 的 eSIM 管理系统，提供了友好的图形界面来管理 eSIM 配置文件。这是桌面版 MiniLPA 的 Web 实现版本。

## 核心功能

### 1. 配置文件管理
- ✅ 查看所有 eSIM 配置文件
- ✅ 下载新的配置文件（通过激活码）
- ✅ 启用/禁用配置文件
- ✅ 删除配置文件
- ✅ 设置配置文件昵称
- ✅ 搜索配置文件

### 2. 通知管理
- ✅ 查看通知列表
- ✅ 处理通知
- ✅ 删除单个通知
- ✅ 批量删除通知
- ✅ 通知选择模式

### 3. 芯片信息
- ✅ 查看 EID（eUICC 标识符）
- ✅ 查看芯片制造商信息
- ✅ 查看芯片证书

### 4. 用户体验
- ✅ 深色/浅色主题切换
- ✅ 多语言支持（中文、英语、日语）
- ✅ 响应式设计（支持手机、平板、PC）
- ✅ 拖拽上传二维码
- ✅ 粘贴激活码/二维码

## 技术架构

### 前端技术栈

- **框架**: Vue 3 (Composition API)
- **构建工具**: Vite
- **状态管理**: Pinia
- **路由**: Vue Router
- **HTTP 客户端**: Axios
- **样式**: SCSS
- **特性**:
  - TypeScript 支持（可选）
  - 组件化开发
  - 响应式设计
  - PWA 支持（可扩展）

### 后端技术栈

- **运行时**: Node.js 18+
- **框架**: Express
- **特性**:
  - RESTful API
  - CORS 支持
  - 错误处理
  - 日志记录
  - 健康检查

### 部署方案

- **容器化**: Docker + Docker Compose
- **Web 服务器**: Nginx 反向代理
- **进程管理**: Docker 容器管理
- **监控**: Docker 日志 + Nginx 日志

## 项目结构详解

```
minilpa-web/
│
├── src/                          # 前端源代码
│   ├── api/                      # API 接口封装
│   │   └── index.js             # Axios 实例和 API 方法
│   │
│   ├── components/               # Vue 组件
│   │   └── Header.vue           # 页面头部组件
│   │
│   ├── locales/                  # 国际化语言包
│   │   ├── zh_CN.js             # 简体中文
│   │   ├── en_US.js             # 英语
│   │   └── ja_JP.js             # 日语
│   │
│   ├── router/                   # 路由配置
│   │   └── index.js             # Vue Router 配置
│   │
│   ├── stores/                   # Pinia 状态管理
│   │   ├── theme.js             # 主题状态
│   │   ├── language.js          # 语言状态
│   │   └── esim.js              # eSIM 数据状态
│   │
│   ├── styles/                   # 样式文件
│   │   └── main.scss            # 全局样式和主题
│   │
│   ├── views/                    # 页面组件
│   │   ├── ProfileView.vue      # 配置文件管理页
│   │   ├── NotificationView.vue # 通知管理页
│   │   ├── ChipView.vue         # 芯片信息页
│   │   └── SettingsView.vue     # 设置页
│   │
│   ├── App.vue                   # 根组件
│   └── main.js                   # 应用入口
│
├── server/                       # 后端源代码
│   ├── routes/                   # API 路由
│   │   ├── profiles.js          # 配置文件路由
│   │   ├── notifications.js     # 通知路由
│   │   ├── chip.js              # 芯片信息路由
│   │   └── qrcode.js            # 二维码解析路由
│   │
│   ├── services/                 # 业务逻辑层
│   │   └── lpa.js               # LPA 服务（核心业务逻辑）
│   │
│   ├── index.js                  # 后端服务入口
│   └── server-static.js          # 前端静态文件服务
│
├── public/                       # 静态资源
│   └── logo.svg                 # 应用图标
│
├── Dockerfile                    # Docker 镜像配置
├── docker-compose.yml           # Docker Compose 配置
├── .dockerignore                # Docker 忽略文件
│
├── nginx.conf                    # Nginx 配置文件
├── deploy.sh                     # 自动部署脚本
├── start.sh                      # 启动脚本
├── stop.sh                       # 停止脚本
│
├── package.json                  # Node.js 依赖配置
├── vite.config.js               # Vite 构建配置
├── .env.example                 # 环境变量示例
├── .gitignore                   # Git 忽略文件
│
├── README.md                     # 项目文档
├── 宝塔部署指南.md               # 详细部署指南
├── 快速启动指南.md               # 快速上手指南
└── 项目说明.md                   # 本文件
```

## API 接口设计

### 配置文件 API

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/profiles` | 获取所有配置文件 |
| POST | `/api/profiles/download` | 下载新配置文件 |
| POST | `/api/profiles/:iccid/enable` | 启用配置文件 |
| POST | `/api/profiles/:iccid/disable` | 禁用配置文件 |
| DELETE | `/api/profiles/:iccid` | 删除配置文件 |
| PATCH | `/api/profiles/:iccid` | 修改配置文件昵称 |

### 通知 API

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/notifications` | 获取所有通知 |
| POST | `/api/notifications/process` | 处理通知 |
| DELETE | `/api/notifications/:seqNumber` | 删除通知 |

### 芯片 API

| 方法 | 路径 | 说明 |
|------|------|------|
| GET | `/api/chip/info` | 获取芯片信息 |
| GET | `/api/chip/certificate` | 获取芯片证书 |

### 工具 API

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/api/qrcode/parse` | 解析二维码 |
| GET | `/api/health` | 健康检查 |

## 数据模型

### Profile（配置文件）

```javascript
{
  iccid: "8986012345678901234",      // ICCID（唯一标识）
  name: "中国移动 eSIM",              // 名称/昵称
  provider: "中国移动",                // 运营商
  state: "enabled"                    // 状态：enabled/disabled
}
```

### Notification（通知）

```javascript
{
  seqNumber: 1,                      // 序列号
  operation: "install",              // 操作类型
  iccid: "8986012345678901234",     // 关联的 ICCID
  timestamp: "2024-01-01T00:00:00Z" // 时间戳
}
```

### ChipInfo（芯片信息）

```javascript
{
  eid: "89049032...",               // EID
  manufacturer: "STMicroelectronics", // 制造商
  model: "ST33J2M0"                  // 型号
}
```

## 部署架构

```
Internet
    |
    | (HTTP/HTTPS)
    v
Nginx (80/443)
    |
    |-- /     --> Frontend Static Server (8080)
    |              (Vue SPA)
    |
    |-- /api/ --> Backend API Server (3001)
                   (Express + LPA Service)
                        |
                        v
                   PCSC Service (可选)
                        |
                        v
                   Smart Card Reader (可选)
```

## 开发流程

### 1. 本地开发

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev      # 前端（端口 3000）
npm run server   # 后端（端口 3001）
```

### 2. 构建生产版本

```bash
# 构建前端
npm run build

# 输出目录：dist/
```

### 3. Docker 部署

```bash
# 构建镜像
docker build -t minilpa-web .

# 运行容器
docker run -d -p 3001:3001 -p 8080:8080 minilpa-web

# 或使用 Docker Compose
docker-compose up -d
```

### 4. 宝塔部署

参考 `宝塔部署指南.md` 或 `快速启动指南.md`

## 扩展开发

### 添加新功能

1. **前端**：
   - 在 `src/views/` 添加新页面
   - 在 `src/components/` 添加新组件
   - 在 `src/router/` 添加路由
   - 在 `src/stores/` 添加状态管理

2. **后端**：
   - 在 `server/routes/` 添加新路由
   - 在 `server/services/` 添加业务逻辑

3. **多语言**：
   - 在 `src/locales/` 各语言文件中添加翻译

### 连接真实硬件

当前版本使用模拟数据。要连接真实的 eSIM 读卡器：

1. 安装 PCSC 服务
2. 安装 lpac 工具
3. 修改 `server/services/lpa.js`
4. 使用 `child_process` 调用 lpac 命令

参考代码：

```javascript
import { spawn } from 'child_process'

async function getProfiles() {
  return new Promise((resolve, reject) => {
    const lpac = spawn('lpac', ['profile', 'list'])
    let output = ''
    
    lpac.stdout.on('data', (data) => {
      output += data.toString()
    })
    
    lpac.on('close', (code) => {
      if (code === 0) {
        resolve(parseOutput(output))
      } else {
        reject(new Error('lpac failed'))
      }
    })
  })
}
```

## 性能优化建议

1. **前端优化**：
   - 启用代码分割（Vite 默认支持）
   - 使用懒加载路由
   - 压缩图片资源
   - 启用 Service Worker（PWA）

2. **后端优化**：
   - 使用连接池（如果使用数据库）
   - 添加缓存层（Redis）
   - 使用 PM2 进程管理
   - 启用 Gzip 压缩

3. **部署优化**：
   - 使用 CDN 加速静态资源
   - 配置 Nginx 缓存
   - 使用负载均衡（多实例）
   - 优化 Docker 镜像大小

## 安全建议

1. ✅ 使用 HTTPS
2. ✅ 配置 CORS 白名单
3. ✅ 添加请求频率限制
4. ✅ 输入验证和过滤
5. ✅ 使用环境变量保护敏感信息
6. ✅ 定期更新依赖包
7. ✅ 实施身份验证（如需要）

## 监控和日志

1. **应用日志**：
   - Docker 容器日志
   - Nginx 访问/错误日志
   - 应用业务日志

2. **监控指标**：
   - CPU 使用率
   - 内存使用率
   - 磁盘空间
   - 网络流量
   - API 响应时间

3. **告警设置**：
   - 服务不可用
   - 资源使用超限
   - 错误率过高

## 维护计划

### 日常维护
- 检查服务状态
- 查看日志异常
- 监控资源使用

### 定期维护
- 备份重要数据
- 更新系统和软件
- 清理日志文件
- 优化数据库（如有）

### 应急处理
- 准备回滚方案
- 记录故障日志
- 分析问题原因
- 优化和改进

## 版本历史

- **v1.0.0** (2024-01): 初始版本
  - 基本功能实现
  - 支持配置文件管理
  - 支持通知管理
  - 多语言和主题支持

## 开发团队

本项目基于 MiniLPA 桌面版开发，感谢原项目的贡献者。

## 许可证

MIT License

## 相关资源

- **原项目**: [MiniLPA](https://github.com/EsimMoe/MiniLPA)
- **lpac 工具**: [lpac](https://github.com/estkme-group/lpac)
- **GSMA eSIM 规范**: [GSMA](https://www.gsma.com/esim/)

---

**祝开发愉快！** 🚀

