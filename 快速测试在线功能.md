# 🚀 快速测试在线人数功能

## ⚠️ 问题：页面没有显示在线人数？

按照以下步骤解决：

---

## ✅ 方法一：使用启动脚本（推荐）

### 步骤 1：启动后端服务器

双击运行：`start-backend.bat`

**或者在命令行：**
```cmd
start-backend.bat
```

**应该看到：**
```
后端服务运行在端口 3001
健康检查: http://localhost:3001/api/health
WebSocket 服务已启动
```

### 步骤 2：启动前端服务器

**在新的命令行窗口，双击运行：**`start-dev.bat`

**或者：**
```cmd
start-dev.bat
```

### 步骤 3：打开浏览器

访问：http://localhost:3000

右上角应该显示：**[🟢 1 在线]**

### 步骤 4：测试多人在线

打开多个浏览器标签页，在线人数会增加：
- 1 个标签页 → 1 在线
- 2 个标签页 → 2 在线
- 3 个标签页 → 3 在线
- ...

---

## ✅ 方法二：手动启动（详细步骤）

### 1. 安装依赖

```bash
npm install
```

**确认安装成功：**
```
+ socket.io@4.7.2
+ socket.io-client@4.7.2
```

### 2. 启动后端（终端 1）

```bash
npm run server
```

**保持这个窗口运行！**

### 3. 启动前端（终端 2）

```bash
npm run dev
```

### 4. 访问并测试

打开：http://localhost:3000

---

## 🔍 调试检查

### 检查 1：依赖是否安装

```bash
npm list socket.io socket.io-client
```

**应该看到：**
```
├── socket.io@4.7.2
└── socket.io-client@4.7.2
```

### 检查 2：后端是否运行

访问：http://localhost:3001/api/health

**应该看到：**
```json
{"status":"ok","timestamp":"2025-11-04T..."}
```

### 检查 3：前端是否连接

打开浏览器控制台（F12），查看 Console：

**应该看到：**
```
WebSocket 已连接
在线人数更新: 1
```

### 检查 4：页面元素

查看页面右上角，应该有：
```
[🟢 指示灯] [数字] [在线]
```

---

## ❌ 常见错误

### 错误 1：`Error: Cannot find module 'socket.io-client'`

**解决：**
```bash
npm install
```

### 错误 2：`EADDRINUSE: address already in use :::3001`

**原因：** 端口被占用

**解决：**
```bash
# Windows
netstat -ano | findstr :3001
taskkill /F /PID <进程ID>

# 或者修改端口
set PORT=3002
npm run server
```

### 错误 3：`WebSocket connection failed`

**原因：** 后端没有运行

**解决：**
```bash
# 先启动后端
npm run server

# 然后启动前端
npm run dev
```

### 错误 4：页面显示 "0 在线"

**原因：** WebSocket 连接失败

**检查：**
1. 后端是否运行？
2. 控制台有错误吗？
3. 网络设置有问题吗？

---

## 🎯 快速测试清单

- [ ] 运行 `npm install`
- [ ] 启动后端 `npm run server`（终端 1）
- [ ] 启动前端 `npm run dev`（终端 2）
- [ ] 访问 http://localhost:3000
- [ ] 看到右上角显示 "1 在线"
- [ ] 打开第二个标签页，看到 "2 在线"
- [ ] 关闭一个标签页，在线人数减少

---

## 📞 还是不行？

### 1. 截图检查

请截图以下内容：
- 浏览器页面（完整页面）
- 浏览器控制台（F12 → Console）
- 后端运行窗口
- 前端运行窗口

### 2. 检查文件是否存在

```bash
dir src\stores\online.js
dir src\components\Header.vue
dir server\index.js
```

### 3. 检查代码版本

```bash
git log --oneline -1
```

应该看到最新的提交包含 "多人在线协作" 相关内容。

---

## 💡 提示

- 必须同时运行**后端**和**前端**两个服务器
- 后端默认端口：3001
- 前端默认端口：3000
- WebSocket 会自动连接到后端
- 每个打开的标签页都算一个在线用户

---

## 🎉 成功标志

看到页面右上角显示：

```
[🟢 1 在线] [🌙] [简体中文]
```

绿色圆点表示 WebSocket 已连接！

